# ACF-VS (Anime Cut Folder Versioning System)

アニメーション制作の撮影工程（Compositing）に特化した、分散作業用の軽量なハッシュベース・バージョン管理システムです。

## 概要 (Overview)

アニメ制作では1つの「カットフォルダ」の中に、Photoshop(BG), Paint(CELL), 3D, AfterEffectsなど多数の素材が含まれます。
作業者によって古いファイルを `(old)` などのサブフォルダに移動する運用がなされることが多く、Gitなどの標準的なバージョン管理では巨大なバイナリファイルの履歴管理が重すぎたり、リネームや移動の追跡が困難になったりする問題がありました。

**ACF-VS** は、ファイルの実体ではなく「ファイルのハッシュ値（指紋）と場所の状態」のみを `.cut_manifest.json` という軽量なマニフェストファイルで管理するCLIツールです。

## 主な特徴 (Features)

*   **ハッシュベースの同一性判定**: SHA-256ハッシュを用いて、ファイル名が変更されても同じファイルとして追跡可能。
*   **`(old)` フォルダのアーカイブ認識**: `Active` な場所にあったファイルが `(old)` という名を含むパスへ移動された場合、単なる「削除と新規作成」ではなく「アーカイブ化」として認識します。
*   **高速モード (Fast Mode)**: 巨大なPSDやAEPファイルを扱うため、完全なハッシュ計算の代わりに「ファイルサイズ＋更新日時」を用いた高速判定 (`--fast`) に対応。
*   **連番画像の自動グループ化**: 数千枚におよぶ連番画像（例: `A_cell_0001.tga` 〜 `1000.tga`）をパターン認識し、1つの統合されたシーケンスとして扱いスキャン結果を要約・高速化します (`--seq`)。
*   **重複ファイル検知**: 全く同じハッシュ値を持つファイルがカットフォルダ内の別の階層に存在する場合、「Redundant Copies」として警告を出します。

## インストール (Installation)

現状はPythonの単一スクリプトとして動作します。標準ライブラリのみを使用しているため、追加の `pip install` は不要です。

```bash
git clone https://github.com/o3x/ACF-VS.git
cd ACF-VS
```

## 使い方 (Usage)

各コマンドは対象となるカットディレクトリのルートで実行するのを基本とします。

### 1. マニフェストの初期化 (`init`)
現在のフォルダの状態をスキャンし、`.cut_manifest.json` を生成します。
```bash
python acvs_core.py init --dir <対象のカットフォルダパス>
```

### 2. 現在の差分を確認 (`status` / `scan`)
前回のマニフェストと比較し、新規追加・更新・削除・アーカイブ移動などの差分を表示します（マニフェストは更新されません）。
```bash
# 通常スキャン
python acvs_core.py status --dir <対象のカットフォルダパス>

# アニメ特化のオプション：巨大ファイル向け高速化 ＆ 連番画像のグループ化
python acvs_core.py status --dir <対象のカットフォルダパス> --fast --seq
```

### 3. マニフェストの更新 (`commit`)
現状のスキャン結果を新しい「正」としてマニフェストを上書き保存します。
```bash
python acvs_core.py commit --dir <対象のカットフォルダパス> --fast --seq
```

## 開発環境向け

テスト用にダミーの連番画像環境を一括生成するスクリプトが付属しています。
```bash
python test_seq_generator.py --dir test_env --count 1000
```
これにより、`test_env` フォルダ内にCELLやBGのダミー連番が生成され、ACF-VS の挙動テストに利用できます。

## ライセンス (License)
MIT License
